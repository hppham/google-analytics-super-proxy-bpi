<!DOCTYPE html>

<html>

<head>
  <title>LineChart</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      var _todayUrl = 'https://gasuperproxybpi.appspot.com/query?id=ahFzfmdhc3VwZXJwcm94eWJwaXIVCxIIQXBpUXVlcnkYgICAgICAgAoM&format=json';
      var _oneDayAgoUrl = 'https://gasuperproxybpi.appspot.com/query?id=ahFzfmdhc3VwZXJwcm94eWJwaXIVCxIIQXBpUXVlcnkYgICAgNrjhgoM&format=json';
      var ajaxCallToday = $.ajax({
        url: _todayUrl,
        type: 'GET',
        dataType: 'jsonp',
        data: {
          format: 'json'
        },
        error: function () {
          $('#info').html('<p>An error has occurred</p>');
        }
      });
      var ajaxCallOneDayAgo = $.ajax({
        url: _oneDayAgoUrl,
        type: 'GET',
        dataType: 'jsonp',
        data: {
          format: 'json'
        },
        error: function () {
          $('#info').html('<p>An error has occurred</p>');
        }
      });

      $.when(ajaxCallToday, ajaxCallOneDayAgo).done(function (today, oneDayAgo) {
        console.log('today: ', today);
        console.log('oneDayAgo: ', oneDayAgo);
      });

      function _getRows(data) {
        var rows = [];
        var currentTime = new Date($.now()).getHours();
        $.each(data.rows, function (index, value) {
          if (index > currentTime)
            return false;

          rows.push([value[0], parseInt(value[1]), value[1] + ' active users at ' + value[0] + ':00']);
        });

        return rows;
      }

      function _startGoogleChart(rows) {
        google.charts.load('current', {
          'packages': ['corechart']
        });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
          var dataTable = new google.visualization.DataTable();
          dataTable.addColumn('string', 'hour');
          dataTable.addColumn('number', 'user');
          dataTable.addColumn({
            type: 'string',
            role: 'tooltip'
          });
          dataTable.addRows(rows);

          var options = {
            tooltip: {
              isHtml: true
            },
            legend: 'none',
            title: 'Number of Students Online',
            width: '100%',
            height: '100%',
            lineWidth: '1',
            pointSize: '10',
            curveType: 'function',
            vAxis: {
              title: 'Number of Students',
              format: 'decimal'
            },
            hAxis: {
              title: 'Time'
            }
          };
          var chart = new google.visualization.LineChart(document.getElementById('vis_div'));
          chart.draw(dataTable, options);
        }
      }
    });
  </script>
</head>

<body style="font-family: Arial;border: 0 none;">
  <div id="info"></div>
  <div id="vis_div" style="width: 100%; height: 100%;"></div>
</body>

</html>